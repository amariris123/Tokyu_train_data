name: Update Toyoko Status Data

on:
  # ワークフローを手動で実行できるようにする設定
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *' 

jobs:
  update-json:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        # 既存コードをクローン
        uses: actions/checkout@v4
        # ★重要: このステップでトークンを設定しないと、後のコミットができません
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Set up Python
        # Python環境の構築
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      - name: Install dependencies
        # requirements.txtに書かれたライブラリのインストール
        run: |
          pip install -r requirements.txt
          
      - name: Ensure public directory exists
        # Vercelなどで公開するために public ディレクトリを作成
        run: mkdir -p public
          
      - name: Run data fetch script
        # データ取得スクリプトの実行
        run: python fetch_data.py
        
      - name: Commit and push changes
        # 更新された JSON ファイルをコミット
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # public/toyoko_data.json のみがコミット対象
          file_pattern: 'public/*.json' 
          commit_message: 'Feat: Update toyoko_data.json [skip ci]'
          # [skip ci] をつけることで、コミットによって再度 Actions が実行されるのを防ぎます
